// This is your Prisma schema file
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ATTENDEE
  ORGANIZER
  ADMIN
}

enum EventStatus {
  DRAFT
  PUBLISHED
  LIVE
  ENDED
  CANCELLED
}

enum TicketStatus {
  PENDING
  CONFIRMED
  CANCELLED
  REFUNDED
}

enum PaymentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  REFUNDED
}

model User {
  id        String   @id @default(uuid())
  firstName String
  lastName  String
  email     String   @unique
  password  String
  role      UserRole @default(ATTENDEE)
  
  // Profile fields
  avatar    String?
  bio       String?  @db.Text
  phone     String?
  
  // Address fields
  street    String?
  city      String?
  state     String?
  zipCode   String?
  country   String?
  
  // Account status
  isVerified        Boolean  @default(false)
  isActive          Boolean  @default(true)
  resetPasswordToken String?
  resetPasswordExpire DateTime?
  
  // Relations
  organizedEvents Event[]   @relation("EventOrganizer")
  tickets        Ticket[]
  payments       Payment[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([email])
  @@index([role])
}

model Event {
  id          String      @id @default(uuid())
  title       String
  description String      @db.Text
  
  // Category & Type
  category    String
  eventType   String
  
  // Dates & Times
  startDate   DateTime
  endDate     DateTime
  startTime   String
  endTime     String
  
  // Location
  isOnline         Boolean  @default(false)
  venueName        String?
  address          String?
  city             String?
  state            String?
  zipCode          String?
  country          String?
  meetingLink      String?
  
  // Pricing
  price            Float    @default(0)
  currency         String   @default("USD")
  
  // Capacity
  maxAttendees     Int
  currentBookings  Int      @default(0)
  
  // Media
  image            String?
  images           String[]
  tags             String[]
  
  // Additional info
  requirements     String?  @db.Text
  refundPolicy     String?  @db.Text
  
  // Status
  status      EventStatus @default(DRAFT)
  publishedAt DateTime?
  featured    Boolean     @default(false)
  views       Int         @default(0)
  
  // Relations
  organizerId String
  organizer   User       @relation("EventOrganizer", fields: [organizerId], references: [id])
  tickets     Ticket[]
  payments    Payment[]
  
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  
  @@index([organizerId])
  @@index([category])
  @@index([status])
  @@index([startDate])
  @@index([featured])
}

model Ticket {
  id            String       @id @default(uuid())
  eventId       String
  attendeeId    String
  ticketType    String
  price         Float
  currency      String        @default("USD")
  status        TicketStatus  @default(PENDING)
  
  qrCode        String?
  checkedIn     Boolean       @default(false)
  checkedInAt   DateTime?
  orderNumber   String        @unique
  
  // Relations
  event       Event     @relation(fields: [eventId], references: [id], onDelete: Cascade)
  attendee    User      @relation(fields: [attendeeId], references: [id], onDelete: Cascade)
  payment     Payment?
  
  metadata    Json?
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  @@index([eventId])
  @@index([attendeeId])
  @@index([orderNumber])
  @@index([status])
}

model Payment {
  id                String         @id @default(uuid())
  userId            String
  eventId           String
  ticketId          String         @unique
  amount            Float
  currency          String         @default("USD")
  stripePaymentId   String?
  paymentMethod     String         @default("card")
  status            PaymentStatus  @default(PENDING)
  transactionId     String         @unique
  
  // Relations
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  event     Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  ticket    Ticket   @relation(fields: [ticketId], references: [id], onDelete: Cascade)
  
  metadata  Json?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([userId])
  @@index([eventId])
  @@index([status])
  @@index([transactionId])
}

